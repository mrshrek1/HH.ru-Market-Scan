# HH.ru — Market Scan

Коротко: этот проект собирает вакансии с сайта hh.ru по ключевому запросу, сохраняет их в Google Sheets и формирует управленческую аналитику (зарплаты, топ‑навыки, города, опыт и т. п.). В ролях — Telegram‑бот (инициирует сбор), n8n‑сценарий (парсинг + запись в Sheets) и Google Sheets (RawData + Analysis).

## Зачем это нужно
- Быстро оценивать рынок труда по роли/ключевому слову.
- Получать сводную аналитику (минимум/максимум/среднее по зарплатам, топ‑навыки, распределение по опыту).
- Автоматизировать сбор данных и рассылку отчётов в Telegram или в канал.

## Ключевые особенности
- Сбор вакансий по одному запросу (например, "product manager").
- Автоочистка листа RawData перед каждым запуском — остаётся только шапка.
- Готовая аналитика на листе Analysis (минимум / максимум / среднее, топ‑навыки, топ‑города, распределение по опыту/должностям).
- Компактный отчёт в Telegram после обработки.

## Структура выгрузки (RawData)
Для каждой вакансии записывается строка с полями (примерный набор):
- Должность
- ЗП_от
- ЗП_до
- Валюта (RUB / USD / EUR и др.; нормализация RUR → RUB на этапе анализа)
- Город
- Компания
- Сфера_деятельности
- Условия (тип занятости)
- Обязанности (описание)
- Требования (key_skills — склеенный список через запятую)
- Опыт
- Ссылка на вакансию

Эти поля дают основу для расчетов и разбиений на листе Analysis.

## Требования
- Аккаунт Google с доступом к Google Sheets.
- n8n (веб‑инстанс или локально) для выполнения сценария.
- Telegram‑бот (токен от @BotFather).
- (Опционально) доступ к API hh.ru, если парсить через API — или использование HTTP/скрейпинга внутри n8n.

## Быстрый старт — пошагово
1. Создайте Telegram‑бота через @BotFather и сохраните токен.
2. Создайте Google Sheets с двумя листами:
   - RawData — первая строка с заголовками (столбцы, перечисленные выше).
   - Analysis — место для сводных таблиц и формул.
3. Импортируйте n8n‑workflow (JSON) в ваш n8n: "Import" → вставьте JSON шага сценария из репозитория (или загрузите файл workflow).
4. В n8n настройте креденшелы:
   - Telegram Bot Token
   - Google Sheets (OAuth / Service account) — убедитесь, что у n8n есть доступ к нужной таблице.
5. В конфигурации workflow укажите ID таблицы (Spreadsheet ID) и имена листов (`RawData`, `Analysis`).
6. Запустите сценарий и от��равьте боту запрос (например: `product manager`). Сценарий соберёт вакансии и заполнит RawData, а затем пересчитает аналитику и пришлёт отчёт в Telegram.

Пример команды для бота:
- product manager
(бот принимает ключевую фразу — регион/фильтры можно добавлять по реализации сценария)

## Примеры формул / подсказки для листа Analysis
(предположим, что колонка зарплаты от — B, до — C, валюта — D, требования — J, город — E)

- Минимальная зарплата в RUB:
  =MIN(FILTER(B2:B, D2:D="RUB", B2:B<>""))
- Максимальная зарплата в RUB:
  =MAX(FILTER(C2:C, D2:D="RUB", C2:C<>""))
- Средняя (по среднему между ЗП_от и ЗП_до) в RUB:
  =AVERAGE(FILTER((IF(B2:B="",C2:C,B2:B)+IF(C2:C="",B2:B,C2:C))/2, D2:D="RUB"))
- Топ‑городов (через QUERY / сводную таблицу):
  =QUERY(E2:E, "select E, count(E) where E<>'' group by E order by count(E) desc limit 10", 0)
- Топ‑навыков (если в колонке J это строки с навыками, разделёнными запятыми):
  =QUERY(FLATTEN(ARRAYFORMULA(TRIM(SPLIT(J2:J, ",")))), "select Col1, count(Col1) where Col1<>'' group by Col1 order by count(Col1) desc limit 20", 0)

Совет: для агрегатов удобно использовать Pivot Table (Данные → Сводная таблица), особенно если структура данных иногда неполная.

## Что делает сценарий (коротко про логику)
- Получает ключевой запрос (от бота).
- Дёргает hh.ru (API или парсинг) и собирает вакансии с нужными полями.
- Очищает лист RawData (кроме шапки) и записывает новые строки.
- Пересчитывает (или оставляет готовые формулы) на листе Analysis.
- Отправляет в Telegram краткий отчёт: количество вакансий, средние/диапазоны по зарплатам, топ‑3 навыка/города.

## Расширения / идеи
- Плановый мониторинг: ежедневные/еженедельные автоотчёты в канал.
- Экспорт PDF/скриншотов отчётов для руководителей.
- Дашборд в Looker Studio / Power BI на основе той же таблицы.
- Алерты при резких изменениях средней зарплаты или спроса.
- Сравнение нескольких ролей — единый сравнительный отчёт.

## Возможные проблемы и решения
- n8n не имеет доступа к Google Sheets — проверьте креденшелы и права доступа к таблице.
- Бот не отвечает — проверьте токен в креденшелах Telegram.
- Пустые значения зарплат — при расчётах используйте FILTER, чтобы исключать пустые строки.
- Неправильная нормализация валют — убедитесь, что RUR приводится к RUB на этапе анализа.

## Контакты и вклад
Автор: mrshrek1 (GitHub)
Если хотите — могу помочь:
- адаптировать и добавить готовый JSON‑workflow в репозиторий;
- настроить примеры формул под вашу структуру колонок;
- сделать автоматическую рассылку отчётов.

## Лицензия
MIT (по умолчанию) — при желании укажите свою лицензию.